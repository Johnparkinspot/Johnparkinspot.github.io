<!doctype HTML>

<html lang="en">
<head>
	<title>Crypto Project</title>
	<!-- Makes it mobile friendly -->
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<!-- add Bootstrap content delivery network (CDN) -->
	<link rel="stylesheet" href="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css">
	<!-- Link JQuery from Google CDN -->
	<script src="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js"> </script>

	
</head>

<script>
var alphabet = ['a','b','c','d','e','f','g','h','i','j','k','l','m','n','o','p','q','r','s','t','u','v','w','x','y','z'];
var letter_freq = [0.08167,0.01492,0.02782,0.04253,0.12702,0.02228,0.02015,0.06094,0.06966,0.00153,0.00772,0.04025,0.02406,0.06749,0.07507,0.01929,0.00095,0.05987,0.06327,0.09056,0.02758,0.00978,0.02361,0.0015,0.01974,0.00074];
// helper functions
function mod(n,m)
{
	return ((n%m)+m) % m;
}
//input 1d array
//output: returns the INDEX of the lowest value in the array 
function get_lowest_index(a)
{
	var temp; 
	var index = 0; 
	temp = a[0]
	for(var i = 1; i < a.length; ++i)
	{
			if(a[i] < temp)
			{
				temp = a[i];
				index = i; 
			}
	}
	
	return index; 
}
function dec_to_bin(bitlength, decimal) // use array.unshift() to push to front of array 
{  
	var remainder;
	var binary = new Array();
	var i;
	for(i = 0; i < bitlength; ++i)
	{
		
		remainder = mod(decimal, 2);
		binary.unshift(remainder); 
		if(decimal == 1)
		{
			if(i < bitlength-1)  // pads the array with 0's if the algm ends too early
			{
				for(var j = i; j < bitlength-1; ++j)
				{
					binary.unshift(0);
				}
			}
			break;
		}
		decimal = Math.floor(decimal / 2);
	}
	return binary; 
}
function bin_to_dec(binary)
{
	var decimal;
	decimal = 0; 
	var index, power;
	index = 0;
	for(var i =binary.length-1; i >= 0; --i)
	{
		if(binary[i] == 1)
		{
		power = Math.pow(2,index);
		decimal = decimal + power; 
		}
		++index;
	}
	
	return decimal; 
}

//input binary array 
//output: character a - z, or * if exceed bounds 
function binary_to_letter(binary)
{
	var letter = new Array();
	var temp = new Array(); 
	var dec = 0; 
	// 5 because bit length is only 5 for a - z
	for(var i = 0; i < binary.length; i += 5)
	{
		temp.push(binary[i]);
		for(var j = 1; j < 5; ++j)
		{
			temp.push(binary[i+j]);
		}
		dec = bin_to_dec(temp); 
		//dec = mod(dec,26); 
		temp = [];
		if(dec > 25)
		{
			letter.push('*'); // check to see if bin not part of alphabet
		}
		else
		letter.push(alphabet[dec]);
	}
	return letter;
}
// end helpers *** 
//tokenzies binary string into blocks of 5 (works)
// [0][0..4] = 1st 5 bit block, [1][0..4] = 2nd 5 bit block 
function tokanize_binary_5bits(array)
{
	var a =[];
	var temp = 0;
	for(var i = 0; i < array.length; i += 5)
	{
		a[temp] = []; // create a
		++temp; 
	}
	temp = 0; 
	
	for(var i = 0; i < array.length; i += 5)
	{
		for(var j = 0; j < 5; ++j)
		{
			a[temp][j] = 0; 
		}	
		++temp; 
	}
	temp = 0; 
	for(var i = 0; i < array.length; i += 5)
	{
		for(var j = 0; j < 5 ; ++j)
		{
			a[temp][j] = array[i+j];
		}
		++temp;
	} 
	temp = 0; 
	return a;
}
// 3d array created (works)
// [0] (first split) [0] 1st block [0..4] binary block
function split_tokenized(tokenized,splits)
{
	var a = []; 
	var temp = 0;
	var temp2 = 0;
	for(var i = 0; i < splits; ++i)
	{
		a[i] = [];
	} // have splits amount of strings
	for(var i = 0; i < splits; ++i)
	{
		for(var j = 0+i; j < tokenized.length; j += splits)
		{
			a[i][temp] = []; 
			for(var k = 0; k < 5; ++k)
			{
				a[i][temp][k] = tokenized[j][k]; 
			}
			++temp;
		}
		temp = 0; 
	}
	return a; 
}
function start1()
{
	var v = document.getElementById("ct").value; // get ct from form
	var ct = new Array();
	for(var i = 0; i < v.length;++i)
	{
		if(v[i] == '0' || v[i] == '1')
		{
			ct.push(parseInt(v[i]));
		}
	} // converts char array to integer array 
	
	// tokenizes ct into 5 bit blocks
	var tokenized = tokanize_binary_5bits(ct); 


	var splits = 15; 
	// keylength is most likely length 15 or 30 
	var split = split_tokenized(tokenized,splits);
	//alert(binary_to_letter(split[0][0]));
	//alert(avgIOC(split));
	
	var chi = chisquared(split); 
	var key = [15,11,0,24,18,1,0,18,10,4,19,1,0,11,11]; 
	
	for(var i = 0; i < splits; ++i)
	{
	
		//alert(get_lowest_index(chi[i]) + ", " + chi[i][get_lowest_index(chi[i])]);
		//key.push(get_lowest_index(chi[i]));
	}
	

	
	
	var letter = [];
	tokenized = decrypt(tokenized, key); 
	for(var i =0 ; i < tokenized.length; ++i)
	{
		letter.push(binary_to_letter(tokenized[i]));
	}
	letter = letter.join("");
	document.getElementById("output").innerHTML = letter; 

}
//input: 3d array split & tokenized array
//output: avgIOC number 
function avgIOC(a)
{
	var avgIOC = 0;
	var sigma; 
	var total;
	var fi = 0; 
	sigma = total = 0; 
	for(var i = 0; i < a.length; ++i) // iterate thru splitted strings
	{
		sigma = 0;
		for(var j = 0; j < 26; ++j) // iterate thru alphabet 
		{
			fi = 0; 
			for(k = 0; k < a[i].length; ++k) // iterate thru tokenized 5-bit blocks (can convert to letters)
			{
				if(binary_to_letter(a[i][k]) == alphabet[j]) // check if equal to a - z 
				{
					fi = fi + 1;
				}
			}
			sigma = sigma + (fi * (fi-1)); 
		}
		sigma = sigma / (a[i].length * (a[i].length - 1));
		total = total + sigma; 
	}
	
	avgIOC = total / a.length; 
	
	return avgIOC; 
} 
//input: 3d array 
//output: chisquared 2d array  (Dont know if works) 
// instead of array shifting it is array XORING 
function chisquared(a)
{
	// chisquared hold all the chisquared numbers [number of splits] [26 entries for each alphabet]
	var chisquared = []; 
	var expectedvalue = []; 
	var count = [];
	var sigma = 0; 
	var total = 0; 
	
	for(var i = 0; i < a.length; ++i)
	{
		chisquared[i] = []; 
		for(var j = 0; j < 26; ++j)
		{
		 chisquared[i][j] = 0; 
		}
	}
	
	
	
	for(var i = 0; i < a.length; ++i)
	{
		for(var key = 0; key < 26; ++key)
		{
				for(var s = 0; s < a[i].length; ++s) // where array XORING will occur 
				{
					var temp = bin_to_dec(a[i][s]); 
					temp = xor_twoletters(temp,key); // xor 
					var newletter = letter_to_binary(temp); 
					a[i][s] = newletter;  // set equal to new letter in 5-bit binary form 
				}

				for(var k = 0; k < 26; ++k) // accumulate count and expectvalue in arrays
				{
					count.push(countchar(a[i],alphabet[k]));
					expectedvalue.push(letter_freq[k] * a[i].length); 
				}
			
				for(var p = 0; p < 26; ++p) // where chi squared calculations occur 
				{	
					sigma = sigma + (Math.pow(count[p]-expectedvalue[p],2) / expectedvalue[p]); 
				}
			chisquared[i][key] = sigma; 
			sigma = 0; 	
			count = [];  // empty array 
			expectedvalue = []; 
		}
	}
	return chisquared;
}
//input: 2d array ( a[i]) and character (used for chisquared fcn)
//output: count of character in a[i] 
function countchar(a,letter)
{
	var count = 0;
	
	for(var i = 0; i < a.length; ++i)
	{
		if(bin_to_dec(a[i]))
		{
			if(binary_to_letter(a[i]) == letter)
			{
			++count;
			}		
		}
	}
	
	return count; 
}
//input: letter character a(0) - z(25) in integer form  
//output: 5-bit binary array (00000 - 11001) 
function letter_to_binary(letterkey)
{
	var binary = [];
	binary = dec_to_bin(5,letterkey);
	return binary; 
}


//input: two numbers 0-25 that represent letters
//output: integer of two numbers are xored 
function xor_twoletters(l1,l2)
{
	var bin_l1 = dec_to_bin(5,l1);
	var bin_l2 = dec_to_bin(5,l2);
	var output = []; 

	for(var i = 0; i < 5; ++i)
	{
		output.push(bin_l1[i] ^ bin_l2[i]);
	}
	output = bin_to_dec(output);
	return output; 

}

//input 2d tokenized array and key array (a = 0, b = 1, etc...)
//output 2d tokenized array 
function decrypt(tokenized,key)
{	
	var temp1;
	var temp2;

	for(var i = 0; i < tokenized.length; ++i)
	{
		temp1 = bin_to_dec(tokenized[i]);
		temp2 = key[mod(i,key.length)];
		var xored = xor_twoletters(temp1,temp2);
		tokenized[i] = dec_to_bin(5,xored);
	}

	return tokenized; 
}

/*
function print_array(a)
{
	var t = [];
	for(var i = 0; i < a.length; ++i)
	{
	}
}
*/ 
</script>


<body>


<!-- Navigation -->
<nav class="navbar navbar-inverse">
  <div class="container-fluid">
    <div class="navbar-header">
      <a class="navbar-brand" href="projects.html">Back</a>
    </div>

  </div>
</nav>
<!-- End Navigation -->
]

<div class="container" style="border: thin solid black">
	<h2> Crypto Project - Decrypting XOR ciphers (PT XOR KEYSTREAM = CT) </h2> 
	<p> <span class="glyphicon glyphicon-time"></span> April 28, 2016 </p>


	<form role="form">
		<div class="form-group">
			<label for="ct">ct </label>
			<input type="text" class="form-control" id="ct" placeholder ="Enter binary CT">
		</div>

		<button type="button" class="btn btn-default" onclick="start1()">CT1 Decrypt</button>

	</form>

	<p id="output" align="center" style="white-space:nowrap;overflow:auto">Output</p>


	<br> <br> 
	<p> ct1: </p>
	<p id="ct1" align="center" style="white-space:nowrap;overflow:auto;">000001101000100010101011001100100111100110010101111010000101001110010111010111010111110010110011011000111000001111111001010100000100011100010111101011000110101101101110110000101111100011011001010101110000000110001000001111010111000111110011111111011010000100100000100010011111100001001000100101100111010111100001110010111010100101011001001000111001110001110101010000111111000010110100010011111111011001101101101010101110010010000000110001001001101000001110100000101111001011001010011000101001101001001111000010100100010100110111000110000100101000000100110001000101011100000111101101100011010011000011010110100001011101100010000001100101101000111011011110111001000000011001000001000001100010100101011000010000000000100110111001010000001011010100011001011110011000011011101011010000001000001011110011001011110010001010010111010011111100001000101001011001101000001111110010101111101101101001001100111000010001101001110011001010000110100111010101110010011101100111001111100001000001110100001000110101110001101001000000100100101111010000101011001100000011001000000001000010111001010000100011101011111000000000001111100110110001111011010010101011110111010101111101000001111100000111011101100000000000000000000100101110011011000001100101010000000001010101111100001111101100111111001111000101101101110111011010100001000001110010101111101101101001000011110011011010010101100100001111100111101101001011000100101101110010001111101111111001110111110011101101011110010001111011000110011001111010010001110111101001000010000000011111111110010101100010000101101000001011001001100010111101010010110110100000101010000101111000111101001110001001111000010010001110101011111010101100001101100011010010100100000101110010111110001001011010110101110000011101010011111110000101111100011011000101011111011101100010001100101100001111100000101101100001101100011100010011001000111011110011011010010111101011010101101100111001101001100001011100110010011001111000111100101110101111010110010010010110001111100010101101101011001000111101110010000000100101100001110000001011101001101010011100111011011111000001111001001011011100001100010110100000000010011100010010001111011011011000000010100001100100101100000001110110100111010111110000100100101110000110000001100101001011010100001011111011100000111111000001100101001000011101110101011101110011011101111001111111101100101101101100010000001011011000100010101110000100101001000011101111011000101110010010111010101111101001010001101101111010000101100100011000101110010111001011011000001110000010001011011000001001111000010100110110001111110011101000100110000000100110100101110001111010001101110011100111100000101000010000110010111111001001110001001001011000010101011010111011100011101111000101110101000010111010110010100011001000010011111101101100001100110101011111100011100100101010000110011000001100100001100101001110011010000011001000010110101100011111100001101001011000000000010011111011101100000100111100101000100000011000010111010100001100110000101101000001010001111100011100101111111011110100111100001111101100010001011001001001001111000010000100010111101010111101000100110111001010011010001011100010010010000000101100011101000101111100010100101010111010100101101101110011011101100000001001000010111101101011110011010011101101011100101000000001101101010100001010000010000101000000010110111000100110000001110011000010011011001101111010000101011010100101011000110111110011101101111000101100111010101110101101011101100100100111100101010101100100000111011011010010110001101000111101111010000001100111101000011000100110110110111111011010000001001101000111011000000110010011100010101000001110101000100111101001001100100111110000100101111110110010001110001100110001011100000111110000000101101110001101000110001001010101001011010001100110010011100110110111000001100101011101011111001000111011101100010000110101100111000101101101110110000100110001001010000001010101110101101000000011001000111000110000100011001111110000001000000011001101111010000001100110001101100011111111000100111101110001100001000000101101101011110110101001100110001011000100100000000100111100110010001111011011001000000001010000010000101000000010110101101101011111101000101100110101000010101110010100001100100101111001111000110001110011001010000110011000101000110000001111101111100010001101111111010010100101110001100101010010011110000111001000000000110000000011011001010000010110001010011101000010001000010100101000000001001001001000011001001010111110100100010011011000000001001011100100010101100001001011010110100111010110111001110010010000100110001000000000111010100010100100010110101100001010111100100000101011000110010001111011000110011000000110010000010111101101011110011010011101100010000110001001011000001001001111000010000100001111010011010000000100010011110010101011011000111001011001100001010010000100100101110110000000011111101011010010000000000011001000111110110101001100110001011111010110000000110111110010111110001010000001011001111101110100100111100101010101100000111101100000000101101101110000110000001111010010001110101111000110010010110100100111000100110000000011101110011101101110011100100111101000010000001101100110001111100010100111010101110010010000000110001000110000101111101100100100010101000001111101101011011011000001000001010011101110101111111100101101101110111100101111101101011011011001001111000010011000010101011000100111100011100001111110010001000001111011010100001000001100100011101111000100100001110100001111101110000001101000111000000011000101011011100001100010110011100000110111111100101100100000000100000011011010000010000110101100111001110100000010101111101111100110000100100101111010000101011001100100101111000110000000010110000100110001000101001000010100011101010000110101011010010110101101010110000010000001110001101001111000001001110000001000100001110000011101001100000001000100101000000001100110001001000000001011000011100011000100101110110111111011001100100111010101110101101011110111001000001111010011000111001000111100011010000001000000001001101011011110111011010111101011111100101101101110111000001001100011000000001000001000010000011101111100110011000001101011101101110001011001001000101010101111010000101100010101011111111001100100111111000000000001100111000001010011111111100001011010100011001000110001101011111001000100001100111111001110100101010000101011010001111101000011111101011110111010100001101011011011000101111011101110011110111101000111000010110011111111011000100010000001101110101111110110000001000010000000010110011001000010101010101001100110000001101000001000100001101000110101100111000011100100110001111100010001111011000001001111111100101000010101101001001010101101101110110010000110010000000000101000000001000101000110000000011001010111100000011011110001001000101011011001000111001110010011100011001100010110101110001010101101001100000001000111011000001001101101100100010100000000011110101000010110010000001100101111100100010011110100010011100011000101111000110101110011101101010010001111110011110101111010000101100010111110011000011111100000010011011010011000001011101110</p>
	<p> Ct1 solved. Key is: playsbasketball </p> 

</div>






</body>

</html>
